@typeparam TEntry where TEntry : Enum

<AInputBase Title="@Title" Subtitle="@Subtitle" Disabled="@Disabled" IsLoading="@IsLoading" Width="@Width">
    <div class="a-enum-chips">
        @foreach (var entry in _entries)
        {
            var isSelected = Value.Contains(entry);
            <button class="a-enum-chip @(isSelected ? "a-enum-chip--selected" : "")"
                    type="button"
                    disabled="@(Disabled || IsLoading)"
                    @onclick="() => Toggle(entry)">
                @if (isSelected)
                {
                    <svg class="a-enum-chip-icon" viewBox="0 0 16 16" fill="currentColor" width="12" height="12"><path d="M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.093 5.4-6.425z"/></svg>
                }
                <span>@FormatName(entry)</span>
            </button>
        }
    </div>
</AInputBase>

@code {
    [Parameter] public string? Title { get; set; }
    [Parameter] public string? Subtitle { get; set; }
    [Parameter] public bool Disabled { get; set; }
    [Parameter] public bool IsLoading { get; set; }
    [Parameter] public int Width { get; set; }
    [Parameter] public List<TEntry> Value { get; set; } = new();
    [Parameter] public EventCallback<List<TEntry>> ValueChanged { get; set; }
    [Parameter] public EventCallback<List<TEntry>> OnChange { get; set; }

    private TEntry[] _entries = Array.Empty<TEntry>();

    protected override void OnInitialized()
    {
        _entries = Enum.GetValues(typeof(TEntry)).Cast<TEntry>().ToArray();
    }

    private string FormatName(TEntry entry)
    {
        var name = entry.ToString()!;
        return System.Text.RegularExpressions.Regex.Replace(name, "(?<!^)([A-Z])", " $1");
    }

    private async Task Toggle(TEntry entry)
    {
        if (Value.Contains(entry))
            Value.Remove(entry);
        else
            Value.Add(entry);

        await ValueChanged.InvokeAsync(Value);
        await OnChange.InvokeAsync(Value);
    }
}
