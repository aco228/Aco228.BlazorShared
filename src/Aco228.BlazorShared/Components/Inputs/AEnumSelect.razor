@typeparam TEntry where TEntry : Enum

<AInputBase Title="@Title" Subtitle="@Subtitle" Disabled="@Disabled" IsLoading="@IsLoading" Width="@Width">
    <select class="a-enum-select"
            disabled="@(Disabled || IsLoading)"
            @onchange="OnSelect">
        @foreach (var entry in _entries)
        {
            <option value="@entry.ToString()" selected="@(entry.Equals(Value))">@FormatName(entry)</option>
        }
    </select>
</AInputBase>

@code {
    [Parameter] public string? Title { get; set; }
    [Parameter] public string? Subtitle { get; set; }
    [Parameter] public bool Disabled { get; set; }
    [Parameter] public bool IsLoading { get; set; }
    [Parameter] public int Width { get; set; }
    [Parameter] public TEntry Value { get; set; } = default!;
    [Parameter] public EventCallback<TEntry> ValueChanged { get; set; }
    [Parameter] public EventCallback<TEntry> OnChange { get; set; }

    private TEntry[] _entries = Array.Empty<TEntry>();

    protected override void OnInitialized()
    {
        _entries = Enum.GetValues(typeof(TEntry)).Cast<TEntry>().ToArray();
    }

    private string FormatName(TEntry entry)
    {
        var name = entry.ToString()!;
        return System.Text.RegularExpressions.Regex.Replace(name, "(?<!^)([A-Z])", " $1");
    }

    private async Task OnSelect(ChangeEventArgs e)
    {
        if (Enum.TryParse(typeof(TEntry), e.Value?.ToString(), out var parsed) && parsed is TEntry val)
        {
            Value = val;
            await ValueChanged.InvokeAsync(Value);
            await OnChange.InvokeAsync(Value);
        }
    }
}
